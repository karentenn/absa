var absa=window.absa||{};absa.apps=absa.apps||{};absa.apps.shortTermInsurance=absa.apps.shortTermInsurance||{};absa.apps.shortTermInsurance.securityFlag=false;absa.apps.shortTermInsurance.onUnsubscribeClick=function(d,b,a){phe.common.hide(document.getElementById("gadget-placeholder-l2-g3010144"));phe.common.hide(document.getElementById("gadget-placeholder-l5-g3010144"));gadgets.pubsub.publish("showHide:offersSpoofContainer","HIDE");var c="proxy?pipe=genericWebservice&ws=SnoozeProcessWebService&action=persistSnoozedData&source="+a+"&functionName="+b;absa.io.makeRequest(c,function(e){})};absa.apps.shortTermInsurance.onTermSlide=function(a){var g=bb.selector.queryAncestor(a,".ap-shortTermInsHO-form");var f=bb.selector.query(g,".ap-stHomeIns-hiddenSliderAmount");var b=bb.selector.query(g,".ap-shortTerm-premiumValues");var d=absa.apps.shortTermInsurance.getTermSliderSelection(a);var h=d.toString().replace(/R /g,"");var e=bb.selector.query(g,".ap-stHomeOwner-RoofType");var c=bb.selector.query(g,".ap-stHomeOwner-Excess");phe.hiddenField.setValue(f,h.replace(/,/g,""));phe.suggestBox.setValue(e,"");phe.suggestBox.setValue(c,"");absa.apps.shortTermInsurance.onRoofTypeAndExcessChange(a);if(b){phe.common.hide(b)}};absa.apps.shortTermInsurance.getTermSliderSelection=function(a){var f="";var h=parseInt(phe.slider.getValue(a));var d=parseInt(phe.slider.getAttribute(a,"keyStep"));var c=parseInt(phe.slider.getAttribute(a,"max"));if(h==c){h--}var b=parseInt(c/(parseInt(d)));var g=parseInt(h/b);var e=(b*g)+(b/2);phe.slider.setValue(a,e);if(e==5){f=absa.locale["Apply/Insurance/Label/R500000"]}else{if(e==15){f=absa.locale["Apply/Insurance/Label/R1000000"]}else{if(e==25){f=absa.locale["Apply/Insurance/Label/R1500000"]}else{if(e==35){f=absa.locale["Apply/Insurance/Label/R2000000"]}else{if(e==45){f=absa.locale["Apply/Insurance/Label/R2500000"]}else{if(e==55){f=absa.locale["Apply/Insurance/Label/R3000000"]}else{if(e==65){f=absa.locale["Apply/Insurance/Label/R3500000"]}else{if(e==75){f=absa.locale["Apply/Insurance/Label/R4000000"]}else{if(e==85){f=absa.locale["Apply/Insurance/Label/R4500000"]}else{if(e==95){f=absa.locale["Apply/Insurance/Label/R5000000"]}}}}}}}}}}return f};absa.apps.shortTermInsurance.onRoofTypeAndExcessChange=function(c){var f=bb.selector.queryAncestor(c,".ap-shortTermInsHO-form");var j=bb.selector.query(f,".ap-stHomeIns-hiddenSliderAmount");var h=bb.selector.query(f,".ap-stHomeOwner-RoofType");var b=bb.selector.query(f,".ap-stHomeOwner-Excess");var g=bb.selector.query(f,".ap-shortTerm-premiumValues");var k=phe.hiddenField.getValue(j);var i=phe.select.getValue(h);var d=phe.select.getValue(b);var e=bb.selector.query(f,".ap-shortTerm-minPremium");if(g){phe.common.hide(g)}if(i!=null&&i!=""&&d!=null&&d!=""){absa.form.validate(f);phe.loadingMessage.showLoadingMessage(f);f.style.position="relative";var a="proxy?pipe=genericWebservice&ws=OffersWebService&action=calculatePremiumForHO&coverAmount="+k+"&roofType="+i+"&excess="+d;absa.io.makeRequest(a,function(l){phe.loadingMessage.hideLoadingMessage(f);if(!l.errors.length){var o=bb.html.createElementFromString(l.text);if(bb.html.hasClass(o,"ap-myAbsaOffers-shortTermCalculatePremium")){var n=bb.selector.query(o,".ap-shortTerm-minPremiumValue");var m=absa.util.formatCurrency(phe.hiddenField.getValue(n));if(m=="R 0.00"){phe.form.displayIOErrorMessage(f,true);phe.common.hide(g)}else{phe.common.show(g);phe.inputReadOnlyText.setValue(e,m)}}}else{phe.form.displayIOErrorMessage(f,true)}})}};absa.apps.shortTermInsurance.onMakeSelect=function(f){var e=bb.selector.queryAncestor(f,".ap-shortTermInsMO-form");if(e){var d=bb.selector.query(e,'input[name="makeDesc"]');var b=bb.selector.query(e,".ap-offersShortTermMotor-manufactureYear");var c=bb.selector.query(e,".ap-offersMotorVehicle-MakeValue");var a=bb.selector.query(e,".ap-shortTerm-premiumValuesMORow");if(a){phe.common.hide(a)}phe.suggestBox.setAttribute(d,"disabled","false");phe.textBox.setValue(f,f.value);phe.hiddenField.setValue(c,f.value);phe.textBox.setValue(d,"");phe.suggestBox.setValue(b,"");phe.textBox.focus(d);phe.suggestBox.setAttribute(d,"multipleRequest","proxy?pipe=genericWebservice&ws=ApplyForNewPolicyWebService&action=getVehicleMakeDetails&make="+f.value)}};absa.apps.shortTermInsurance.onMakeModelSelect=function(h){var g=bb.selector.queryAncestor(h,".ap-shortTermInsMO-form");var f=bb.selector.query(g,'input[name="manufactureYear"]');var a=bb.selector.query(g,'input[name="modelDesc"]');var c=bb.selector.query(g,".ap-offersMotorVehicle-ModelValue");var b=bb.selector.query(g,".ap-shortTerm-premiumValuesMORow");var e=phe.suggestBox.getValue(a);phe.suggestBox.setAttribute(f,"disabled","false");phe.textBox.setValue(h,h.value);phe.hiddenField.setValue(c,h.value);var d=h.value;d=absa.apps.shortTermInsurance.vehicleMakeCheck(d);phe.textBox.setValue(f,"");absa.form.validate.checkElement(h);phe.textBox.focus(f);if(b){phe.common.hide(b)}phe.suggestBox.setAttribute(f,"multipleRequest","proxy?pipe=genericWebservice&ws=ApplyForNewPolicyWebService&action=getVehicleMakeDetails&model="+d+"&make="+e)};absa.apps.shortTermInsurance.onMakeModelYearSelect=function(f){var k=bb.selector.queryAncestor(f,".ap-shortTermInsMO-form");var n=bb.selector.query(k,".ap-offersShortTermMotor-makeDesc");var m=bb.selector.query(k,".ap-offersShortTermMotor-modelDesc");var i=bb.selector.query(k,".ap-offersShortTermMotor-manufactureYear");var g=bb.selector.query(k,".ap-offersMotorVehicle-retailValue");var a=bb.selector.query(k,".ap-offersMotorVehicle-YearValue");var l=bb.selector.query(k,".ap-shortTerm-premiumValuesMORow");var d=phe.suggestBox.getValue(n);var h=phe.suggestBox.getValue(m);var c=phe.suggestBox.getValue(i);var e=c.split(" ",1);phe.hiddenField.setValue(a,e);if(l){phe.common.hide(l)}var b="proxy?pipe=genericWebservice&ws=ManagePolicyDetailsWebService&action=fetchMotorVehicleRetailValue&mode=retailValue&vehicleModelDetails="+h+"&vehicleMakeDetails="+d+"&vehicleManufactureYearDetails="+c;var j=false;absa.io.makeRequest(b,function(r){if(!r.errors.length){var t=bb.html.createElementFromString(r.text);if(bb.html.hasClass(t,"ap-applyForMotorVehicleDiv-retailValue")){var s=bb.selector.queryAll(t,".ui-message");var o=bb.selector.queryAll(t,".ap-applyForMotorVehicle-retailValue");if(o.length>0){for(var q=0;q<o.length;q++){retailValue1=phe.hiddenField.getValue(o[q]);phe.hiddenField.setValue(g,retailValue1)}}for(var p=0;p<s.length;p++){if(!bb.html.hasClass(s[p],"ui-message-warning")){j=true;break}}}absa.apps.shortTermInsurance.callMOVPMS(k)}else{absa.showIOErrorMessage(oDiv)}})};absa.apps.shortTermInsurance.callMOVPMS=function(i){if(absa.form.validate(i)){var j=bb.selector.query(i,".ap-shortTerm-premiumValuesMORow");var g=bb.selector.query(i,".ap-shortTerm-minPremiumMO");var e=bb.selector.query(i,".ap-offersMotorVehicle-MakeValue");var c=bb.selector.query(i,".ap-offersMotorVehicle-retailValue");var a=bb.selector.query(i,".ap-offersMotorVehicle-YearValue");var l=bb.selector.query(i,".ap-offersMotorVehicle-ModelValue");var d=phe.hiddenField.getValue(e);var h=phe.hiddenField.getValue(l);var k=parseInt(phe.hiddenField.getValue(c));var f=k.toString();var m=phe.hiddenField.getValue(a);if(d!=""&&h!=""&&f!=""&&m!=""){phe.loadingMessage.showLoadingMessage(i);i.style.position="relative";var b="proxy?pipe=genericWebservice&ws=OffersWebService&action=calculatePremiumForMO&motorVehicleMake="+d+"&motorVehicleModel="+h+"&motorVehicleYear="+m+"&motorVehicleRetailValue="+f;absa.io.makeRequest(b,function(n){phe.loadingMessage.hideLoadingMessage(i);if(!n.errors.length){var q=bb.html.createElementFromString(n.text);if(bb.html.hasClass(q,"ap-myAbsaOffers-shortTermCalculatePremiumMO")){var p=bb.selector.query(q,".ap-shortTerm-minPremiumValueMO");var o=absa.util.formatCurrency(phe.hiddenField.getValue(p));if(o=="R 0.00"){phe.form.displayIOErrorMessage(i,true);phe.common.hide(j)}else{phe.common.show(j);phe.inputReadOnlyText.setValue(g,o)}}}else{phe.form.displayIOErrorMessage(i,true)}})}}};absa.apps.shortTermInsurance.vehicleMakeCheck=function(f){var a=false;for(var c=0;c<=f.length;c++){if(f[c]=="+"){a=true;break}}if(a){var e=f;var d=e.substring(0,e.indexOf("+"));var b=e.substring(e.indexOf("+")+1,e.length);f=d+"$"+b;return f}return f};absa.apps.shortTermInsurance.onApplyGetQuote=function(f,h){var g=bb.selector.queryAncestor(f,".ap-myAbsaOffers-ShortTermInsurance-gadget-content");var r=null;var o="";var k="";if(h=="SHORT_TERM_INSURANCE_HOME_BUILDING_APPLY"){r=bb.selector.queryAncestor(f,".ap-shortTermInsHO-form");o={productType:"HO"};var j=bb.selector.query(r,".ap-shortTerm-minPremium");var b=phe.inputReadOnlyText.getValue(j);var a=(b.replace(/R /g,"")).replace(/,/g,"");k="Min:"+a}else{if(h=="SHORT_TERM_INSURANCE_MOTOR_VEHICLE_APPLY"){r=bb.selector.queryAncestor(f,".ap-shortTermInsMO-form");var s=bb.selector.query(r,".ap-offersMotorVehicle-MakeValue");var e=bb.selector.query(r,".ap-offersMotorVehicle-retailValue");var p=bb.selector.query(r,".ap-offersMotorVehicle-YearValue");var m=bb.selector.query(r,".ap-offersMotorVehicle-ModelValue");var d=bb.selector.query(r,".ap-shortTerm-minPremiumMO");var b=phe.inputReadOnlyText.getValue(d);var i=phe.hiddenField.getValue(s);var n=phe.hiddenField.getValue(m);var t=phe.hiddenField.getValue(e);var u=phe.hiddenField.getValue(p);k="Min:"+(b.replace(/R /g,"")).replace(/,/g,"");o={productType:"MotorVCL",vehicleMake:i,vehicleModel:n,vehicleRetailValue:t,vehicleYear:u}}else{if(h=="SHORT_TERM_INSURANCE_HOME_CONTENT_APPLY"){r=bb.selector.queryAncestor(f,".ap-shortTermInsHC-form");o={productType:"HH"};var q=bb.selector.query(r,".ap-stHomeContent-minPremium");var b=phe.inputReadOnlyText.getValue(q);k="Min:"+(b.replace(/R /g,"")).replace(/,/g,"")}}}if(absa.form.validate(r)){var l="proxy?pipe=genericWebservice&ws=OffersTransactionalApplyWebService&action=updateApplyFlagAndLoggingForOffersGadgets&productType="+h+"&amount="+k;absa.io.makeRequest(l,function(v){});if(absa.RBAINDICATORFORINSURANCE=="true"&&h=="SHORT_TERM_INSURANCE_MOTOR_VEHICLE_APPLY"){var c="MotorVehicle";absa.apps.shortTermInsurance.doRiskProfiling(c)}else{if(absa.RBAINDICATORFORINSURANCE=="true"&&h=="SHORT_TERM_INSURANCE_HOME_CONTENT_APPLY"){var c="HouseholdContents";absa.apps.shortTermInsurance.doRiskProfiling(c)}else{if(absa.RBAINDICATORFORINSURANCE=="true"&&h=="SHORT_TERM_INSURANCE_HOME_BUILDING_APPLY"){var c="HomeOwners";absa.apps.shortTermInsurance.doRiskProfiling(c)}else{gadgets.pubsub.publish("goTo:apply/insurance/applyInsurance",o)}}}}};absa.apps.shortTermInsurance.onTermSlideForHouseholdContent=function(b){var f=bb.selector.queryAncestor(b,".ap-shortTermInsHC-form");var e=bb.selector.query(f,".ap-stHomeContent-RoofType");var i=bb.selector.query(f,".ap-stHomeContent-Excess");var c=bb.selector.query(f,".ap-stHomeContent-securityGuard");phe.suggestBox.setValue(e,"");phe.suggestBox.setValue(i,"");phe.radioGroup.setValue(c,"");absa.apps.shortTermInsurance.securityFlag=false;var h=bb.selector.query(f,".ap-stHomeContentIns-hiddenSliderAmount");var g=bb.selector.query(f,".ap-stHomeContent-premiumRow");var a=absa.apps.shortTermInsurance.getTermSliderSelectionForHomeContent(b);var d=a.toString().replace(/R /g,"");phe.hiddenField.setValue(h,d.replace(/,/g,""));absa.apps.shortTermInsurance.onRoofTypeAndExcessAndSecurityChangeForHomeContent(b);if(g){phe.common.hide(g)}};absa.apps.shortTermInsurance.getTermSliderSelectionForHomeContent=function(a){var f="";var h=parseInt(phe.slider.getValue(a));var d=parseInt(phe.slider.getAttribute(a,"keyStep"));var c=parseInt(phe.slider.getAttribute(a,"max"));if(h==c){h--}var b=parseInt(c/(parseInt(d)));var g=parseInt(h/b);var e=(b*g)+(b/2);phe.slider.setValue(a,e);if(e==5){f=absa.locale["Apply/Insurance/Label/R100000"]}else{if(e==15){f=absa.locale["Apply/Insurance/Label/R200000"]}else{if(e==25){f=absa.locale["Apply/Insurance/Label/R300000"]}else{if(e==35){f=absa.locale["Apply/Insurance/Label/R400000"]}else{if(e==45){f=absa.locale["Apply/Insurance/Label/R500000"]}else{if(e==55){f=absa.locale["Apply/Insurance/Label/R600000"]}else{if(e==65){f=absa.locale["Apply/Insurance/Label/R700000"]}else{if(e==75){f=absa.locale["Apply/Insurance/Label/R800000"]}else{if(e==85){f=absa.locale["Apply/Insurance/Label/R900000"]}else{if(e==95){f=absa.locale["Apply/Insurance/Label/R1000000"]}}}}}}}}}}return f};absa.apps.shortTermInsurance.onRoofTypeAndExcessAndSecurityChangeForHomeContent=function(c){var g=bb.selector.queryAncestor(c,".ap-shortTermInsHC-form");var l=bb.selector.query(g,".ap-stHomeContentIns-hiddenSliderAmount");var k=bb.selector.query(g,".ap-stHomeContent-RoofType");var b=bb.selector.query(g,".ap-stHomeContent-Excess");var h=bb.selector.query(g,".ap-stHomeContent-securityGuard");var i=bb.selector.query(g,".ap-stHomeContent-premiumRow");var e=bb.selector.query(g,".ap-stHomeContent-minPremium");var m=phe.hiddenField.getValue(l);var j=phe.select.getValue(k);var d=phe.select.getValue(b);var f=phe.radioGroup.getValue(h);if(i){phe.common.hide(i)}if(f===absa.locale["Common/General/Label/Yes"]){f="Yes"}else{if(f===absa.locale["Common/General/Label/No"]){f="No"}}if(j!=null&&j!=""&&d!=null&&d!=""&&f!=null&&f!=""&&absa.apps.shortTermInsurance.securityFlag==true){absa.form.validate(g);phe.loadingMessage.showLoadingMessage(g);g.style.position="relative";var a="proxy?pipe=genericWebservice&ws=OffersWebService&action=calculatePremiumForHC&coverAmount="+m+"&roofType="+j+"&excess="+d+"&securityGuard="+f;absa.io.makeRequest(a,function(n){phe.loadingMessage.hideLoadingMessage(g);if(!n.errors.length){var q=bb.html.createElementFromString(n.text);if(bb.html.hasClass(q,"ap-stHomeContent-calcPremiumResponseDiv")){var p=bb.selector.query(q,".ap-stHomeContent-minPremiumValue");var o=absa.util.formatCurrency(phe.hiddenField.getValue(p));if(o=="R 0.00"){phe.form.displayIOErrorMessage(g,true);phe.common.hide(i)}else{phe.inputReadOnlyText.setValue(e,o);phe.common.show(i)}}}else{phe.form.displayIOErrorMessage(g,true)}})}};absa.apps.shortTermInsurance.onSecurityChange=function(a){absa.apps.shortTermInsurance.securityFlag=true;absa.apps.shortTermInsurance.onRoofTypeAndExcessAndSecurityChangeForHomeContent(a)};absa.apps.shortTermInsurance.doRiskProfiling=function(b){var a="proxy?pipe=genericWebservice&ws=RbaWebService&action=getCasaStatus";var c="";if(b=="MotorVehicle"){c=absa.locale["AFS/InsuranceLandingPage/Label/AbsaOnlineCar"]}else{if(b=="HouseholdContents"){c=absa.locale["AFS/InsuranceLandingPage/Label/AbsaOnlineHomeContents"]}else{if(b=="HomeOwners"){c=absa.locale["AFS/InsuranceLandingPage/Label/AbsaOnlineHomeBuilding"]}}}absa.io.makeRequest(a,function(g){if(!g.errors.length){var f=bb.html.createElementFromString(g.text);var i=phe.common.getAttribute(f,"casaReference");var h=phe.common.getAttribute(f,"casaApproved");var d=bb.selector.query(f,".ap-rba-errorMessage");absa.index.oCasaAlertModal=bb.selector.query(window.document,".modalCasaAlertWarning");var e=bb.selector.query(absa.index.oCasaAlertModal,".modalCasaAlertBody");if(e.hasChildNodes()){e.removeChild(e.childNodes[0])}if(h=="true"){absa.modal.loadModal("proxy?pipe=genericEmptyResponse&xslFile=Apply/checkRBAForInsuranceProducts&fromOffers=true&productType="+b+"&casaRef="+i,c)}else{if(d){phe.message.setMessage(d,absa.locale["AFS/General/Label/RBAErrorMessageLife"]);e.appendChild(d,e);phe.modal.showModal(0.5,absa.index.oCasaAlertModal,document.body,true)}}}})};absa.apps.shortTermInsurance.onContinueRBACheck=function(i,g){var h=null;var a;var j=bb.selector.queryAncestor(i,".ap-checkRBAForInsurance-form");var k=bb.selector.query(j,".ap-insurance-sourceOfFunds");var d=bb.selector.query(j,".ap-checkRBAForInsurance-casaRef");var b=bb.selector.query(j,".ap-managePersonalDetails-occupationStatus");var m=bb.selector.query(j,".ap-managePersonalDetails-occupation");var c=phe.select.getValue(k);var f=phe.hiddenField.getValue(d);var l=phe.select.getValue(b);if(l=="04"||l=="05"||l=="06"||l=="07"||l=="10"){var n=0}else{var n=phe.select.getValue(m)}var e="proxy?pipe=genericWebservice&ws=RbaWebService&action=getRiskProfile&fromOffers=true&productType="+g+"&casaRef="+f+"&empStatus="+l+"&occupation="+n+"&sourceOfFund="+c;absa.io.makeRequest(e,function(r){if(!r.errors.length){var x=bb.html.createElementFromString(r.text);var p=phe.common.getAttribute(x,"riskRating");var s=phe.common.getAttribute(x,"riskAcceptable");if((p=="L"||p=="M"||p=="VL")&&s=="true"){phe.modal.hideModal();if(g=="MotorVehicle"){h=bb.selector.query(window.document,".ap-shortTermInsMO-form");var w=bb.selector.query(h,".ap-offersMotorVehicle-MakeValue");var t=bb.selector.query(h,".ap-offersMotorVehicle-retailValue");var o=bb.selector.query(h,".ap-offersMotorVehicle-YearValue");var B=bb.selector.query(h,".ap-offersMotorVehicle-ModelValue");var z=bb.selector.query(h,".ap-shortTerm-minPremiumMO");var y=phe.inputReadOnlyText.getValue(z);var u=phe.hiddenField.getValue(w);var A=phe.hiddenField.getValue(B);var v=phe.hiddenField.getValue(t);var q=phe.hiddenField.getValue(o);a={productType:"MotorVCL",vehicleMake:u,vehicleModel:A,vehicleRetailValue:v,vehicleYear:q}}else{if(g=="HouseholdContents"){h=bb.selector.query(window.document,".ap-shortTermInsHC-form");a={productType:"HH"}}else{if(g=="HomeOwners"){h=bb.selector.query(window.document,".ap-shortTermInsHO-form");a={productType:"HO"}}}}if(absa.form.validate(h)){gadgets.pubsub.publish("goTo:apply/insurance/applyInsurance",a)}}else{phe.common.show(bb.selector.query(j,".ap-checkRBAForInsurance-errorMessage"))}}else{absa.showIOErrorMessage(j)}})};