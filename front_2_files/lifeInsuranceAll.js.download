var absa=absa||{};absa.apps=absa.apps||{};absa.apps.lifeInsurance=absa.apps.lifeInsurance||{};absa.apps.lifeInsurance.premiums=absa.apps.lifeInsurance.premiums||{};absa.apps.lifeInsurance.premiums.amounts=[];absa.apps.lifeInsurance.onSlide=function(b){var f=bb.selector.queryAncestor(b,".ap-lifeCoverMain-form");if(f!=null){var a=bb.selector.query(f,".ap-myAbsaOffers-insPremium");var c=absa.apps.lifeInsurance.getSliderSelection(b);phe.inputReadOnlyText.setValue(a,"R "+c+" pm");var e=bb.selector.query(f,".ap-sliderValues-hiddensliderValueGroup");phe.hiddenField.setValue(e,c);var d=bb.selector.query(f,".ap-sliderValue-coverAmount");if(phe.slider.getValue(b)=="5"){phe.hiddenField.setValue(d,"20000")}if(phe.slider.getValue(b)=="15"){phe.hiddenField.setValue(d,"40000")}if(phe.slider.getValue(b)=="25"){phe.hiddenField.setValue(d,"60000")}if(phe.slider.getValue(b)=="35"){phe.hiddenField.setValue(d,"80000")}if(phe.slider.getValue(b)=="45"){phe.hiddenField.setValue(d,"100000")}}};absa.apps.lifeInsurance.onSlideAffinity=function(b){var f=bb.selector.queryAncestor(b,".ap-lifeCoverMain-form");if(f!=null){var a=bb.selector.query(f,".ap-myAbsaOffers-insPremium");var c=absa.apps.lifeInsurance.getSliderSelection(b);var d=c;phe.inputReadOnlyText.setValue(a,"R "+d.substring(d.indexOf("-")+1,d.length)+" pm");var e=bb.selector.query(f,".ap-sliderValues-hiddensliderValueGroup");phe.hiddenField.setValue(e,c)}};absa.apps.lifeInsurance.onSlideUltimate=function(b){var f=bb.selector.queryAncestor(b,".ap-lifeCoverMain-form");if(f!=null){var a=bb.selector.query(f,".ap-myAbsaOffers-insPremium");var c=absa.apps.lifeInsurance.getSliderSelection(b);var d=c;phe.inputReadOnlyText.setValue(a,"R "+d.substring(d.indexOf("-")+1,d.length)+" pm");var e=bb.selector.query(f,".ap-sliderValues-hiddensliderValueGroup");phe.hiddenField.setValue(e,c)}};absa.apps.lifeInsurance.onContinueClick=function(c){var e=bb.selector.queryAncestor(c,".ap-lifeCoverMain-form");var b=bb.selector.query(e,".ap-sliderValues-hiddensliderValueGroup");var a=b.value;var d="UL";if(absa.RBAINDICATORFORINSURANCE=="true"){absa.apps.lifeInsurance.doRiskProfiling(d)}else{var f={productType:d,getSliderSelection:a};if(absa.form.validate(e)){gadgets.pubsub.publish("goTo:apply/insurance/applyInsurance",f)}}};absa.apps.lifeInsurance.getSliderSelection=function(a){var h=bb.selector.queryAncestor(a,".ap-lifeCoverMain-form");if(h!=null){absa.apps.lifeInsurance.initializeInsurancePremiumArray(h)}var g=parseInt(phe.slider.getValue(a));var d=parseInt(phe.slider.getAttribute(a,"keyStep"));var c=parseInt(phe.slider.getAttribute(a,"max"));if(g==c){g--}var b=parseInt(c/(parseInt(d)));var f=parseInt(g/b);var e=(b*f)+(b/2);phe.slider.setValue(a,e);return absa.apps.lifeInsurance.premiums.amounts[f]};absa.apps.lifeInsurance.initializeInsurancePremiumArray=function(d){if(absa.apps.lifeInsurance.premiums.amounts.length==0){var c=bb.selector.queryAll(d,".ap-myAbsaOffers-hiddenLifePremium");for(var b=0;c.length>b;b++){var a=phe.hiddenField.getValue(c[b]);absa.apps.lifeInsurance.premiums.amounts.push(a)}}};absa.apps.lifeInsurance.onLifeCoverGetQuote=function(h,c,e){var j=bb.selector.queryAncestor(h,".ap-lifeCoverMain-form");var d=bb.selector.query(j,".ap-sliderValues-hiddensliderValueGroup");var g=bb.selector.query(j,".ap-sliderValue-coverAmount");var f="";if(c=="applyClassicLife"&&e=="No"){f="LIFE_INSURANCE_LIFE_COVER_OFFERS"}else{if(c=="applyClassicLife"&&e=="Yes"){f="LIFE_INSURANCE_LIFE_COVER_UPSELL_OFFERS"}else{if(c=="applyFuneralPlan"){f="LIFE_INSURANCE_FUNERAL_COVER_OFFERS"}else{if(c=="applyFreeCover"){f="LIFE_INSURANCE_FREE_COVER_OFFERS"}}}}var l=d.value;var k=g.value;var b={productType:c,getSliderSelection:k};var a="proxy?pipe=genericWebservice&ws=OffersTransactionalApplyWebService&action=updateApplyFlagAndLoggingForOffersGadgets&productType="+f;absa.io.makeRequest(a,function(m){});if(absa.RBAINDICATORFORINSURANCE=="true"&&c=="applyFuneralPlan"){var i="FuneralPlan";absa.apps.lifeInsurance.doRiskProfiling(i)}else{gadgets.pubsub.publish("goTo:apply/insurance/applyInsurance",b)}};absa.apps.lifeInsurance.onAffinityGetQuote=function(d,f){var e=bb.selector.queryAncestor(d,".ap-lifeCoverMain-form");var c=bb.selector.query(e,".ap-sliderValues-hiddensliderValueGroup");var a="";a="LIFE_INSURANCE_AFFINITY_COVER_OFFERS";var b=c.value;var g={productType:f,getSliderSelection:b};absa.io.makeRequest("proxy?pipe=genericWebservice&ws=PersonalInformationWebService&action=hasAllMandatoryCIFDetails",function(j){if(!j.errors.length){var k=bb.html.createElementFromString(j.text);if(bb.html.hasClass(k,"ap-applyButtonCheck-hasAllMandatoryCIFDetailDiv")){var i=bb.selector.query(k,".ap-applyButtonCheck-hasAllMandatoryCIFDetailId");var h=phe.hiddenField.getValue(i);if(h=="true"){absa.io.makeRequest("proxy?pipe=genericWebservice&ws=PersonalInformationWebService&action=hasAllMandatoryCIFDetails",function(o){if(!o.errors.length){var n=bb.html.createElementFromString(o.text);if(bb.html.hasClass(n,"ap-applyButtonCheck-hasAllMandatoryCIFDetailDiv")){var m=bb.selector.query(n,".ap-applyButtonCheck-hasAllMandatoryCIFDetailId");var l=phe.hiddenField.getValue(m);if(l=="true"){gadgets.pubsub.publish("goTo:apply/insurance/applyInsurance",g)}else{absa.index.oCIFAlertModal=bb.selector.query(document.body,".modalCIFAlertWarning");phe.modal.showModal(0.5,absa.index.oCIFAlertModal,document.body,true)}}}});gadgets.pubsub.publish("goTo:apply/insurance/applyInsurance",g)}else{absa.index.oCIFAlertModal=bb.selector.query(document.body,".modalCIFAlertWarning");phe.modal.showModal(0.5,absa.index.oCIFAlertModal,document.body,true)}}}})};absa.apps.lifeInsurance.onUnsubscribeClick=function(d,b,a){phe.common.hide(document.getElementById("gadget-placeholder-l2-g3010138"));phe.common.hide(document.getElementById("gadget-placeholder-l5-g3010138"));gadgets.pubsub.publish("showHide:offersSpoofContainer","HIDE");var c="proxy?pipe=genericWebservice&ws=SnoozeProcessWebService&action=persistSnoozedData&source="+a+"&functionName="+b;absa.io.makeRequest(c,function(e){})};absa.apps.lifeInsurance.doRiskProfiling=function(b){var a="proxy?pipe=genericWebservice&ws=RbaWebService&action=getCasaStatus";var c="";if(b=="UL"){c=absa.locale["AFS/InsuranceLandingPage/Label/UltimateProtector"]}else{if(b=="FuneralPlan"){c=absa.locale["AFS/InsuranceLandingPage/Label/AbsaOnlineFuneralCover"]}}absa.io.makeRequest(a,function(g){if(!g.errors.length){var f=bb.html.createElementFromString(g.text);var i=phe.common.getAttribute(f,"casaReference");var h=phe.common.getAttribute(f,"casaApproved");var d=bb.selector.query(f,".ap-rba-errorMessage");absa.index.oCasaAlertModal=bb.selector.query(window.document,".modalCasaAlertWarning");var e=bb.selector.query(absa.index.oCasaAlertModal,".modalCasaAlertBody");if(e.hasChildNodes()){e.removeChild(e.childNodes[0])}if(h=="true"){absa.modal.loadModal("proxy?pipe=genericEmptyResponse&xslFile=Apply/checkRBAForInsuranceProducts&fromOffers=true&productType="+b+"&casaRef="+i,c)}else{if(d){phe.message.setMessage(d,absa.locale["AFS/General/Label/RBAErrorMessageLife"]);e.appendChild(d,e);phe.modal.showModal(0.5,absa.index.oCasaAlertModal,document.body,true)}}}})};absa.apps.lifeInsurance.onContinueRBACheck=function(k,h){var i=bb.selector.query(window.document,".ap-lifeCoverMain-form");var j;var f;var a;var l=bb.selector.queryAncestor(k,".ap-checkRBAForInsurance-form");var m=bb.selector.query(l,".ap-insurance-sourceOfFunds");var d=bb.selector.query(l,".ap-checkRBAForInsurance-casaRef");var b=bb.selector.query(l,".ap-managePersonalDetails-occupationStatus");var o=bb.selector.query(l,".ap-managePersonalDetails-occupation");var c=phe.select.getValue(m);var g=phe.hiddenField.getValue(d);var n=phe.select.getValue(b);if(n=="04"||n=="05"||n=="06"||n=="07"||n=="10"){var p=0}else{var p=phe.select.getValue(o)}var e="proxy?pipe=genericWebservice&ws=RbaWebService&action=getRiskProfile&fromOffers=true&productType="+h+"&casaRef="+g+"&empStatus="+n+"&occupation="+p+"&sourceOfFund="+c;absa.io.makeRequest(e,function(r){if(!r.errors.length){var q=bb.html.createElementFromString(r.text);var t=phe.common.getAttribute(q,"riskRating");var s=phe.common.getAttribute(q,"riskAcceptable");if((t=="L"||t=="M"||t=="VL")&&s=="true"){phe.modal.hideModal();if(h=="UL"){j=bb.selector.query(i,".ap-sliderValues-hiddensliderValueGroup");f=phe.slider.getValue(j);a={productType:"UL",getSliderSelection:f,sourceOfFund:c}}else{if(h=="FuneralPlan"){j=bb.selector.query(i,".ap-sliderValue-coverAmount");f=phe.slider.getValue(j);a={productType:"applyFuneralPlan",getSliderSelection:f,sourceOfFund:c}}}if(absa.form.validate(i)){gadgets.pubsub.publish("goTo:apply/insurance/applyInsurance",a)}}else{phe.common.show(bb.selector.query(l,".ap-checkRBAForInsurance-errorMessage"))}}else{absa.showIOErrorMessage(l)}})};